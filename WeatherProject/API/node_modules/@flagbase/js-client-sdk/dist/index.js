!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FlagbaseClient=t():e.FlagbaseClient=t()}(this,(()=>(()=>{"use strict";var e={640:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(554);t.default=function(e,t){const n=()=>e.getIdentity().identifier,a=()=>e.getIdentityTraits();return{variation:(t,n)=>{var r;return(null===(r=e.getFlag(t))||void 0===r?void 0:r.variationKey)||n},getIdentifier:n,setIdentifier:a=>{e.setIdentity({identifier:a}),t.emit(r.EventType.CONTEXT_CHANGE,`Updated identifier, identifier=${a}`,n())},getAllTraits:a,getTrait:e=>a()[e],setTrait:(n,i)=>{e.setIdentityTraits({[n]:i}),t.emit(r.EventType.CONTEXT_CHANGE,`Updated trait, ${n}=${JSON.stringify(i)}`,a())},getAllFlags:()=>e.getAllFlags(),getInternalData:()=>e.getInternalData()}}},703:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(640));t.default=a.default},52:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(n(703)),u=i(n(555)),l=o(n(554)),c=o(n(488));t.default=function(e,t,n){const r=Object.assign({mode:u.Mode.POLLING},n),a=l.default(),i=u.default(e,r,t),o=c.default(e,i,a),f=s.default(i,a);o.start();const{on:d,off:_,clear:E}=a;return Object.assign(Object.assign({},f),{on:d,off:_,clear:E,destroy:()=>{E(),o.stop()}})}},899:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(52));t.default=a.default},166:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CONFIG=t.Mode=void 0,function(e){e[e.HYBRID=0]="HYBRID",e[e.POLLING=1]="POLLING",e[e.STREAMING=2]="STREAMING"}(n=t.Mode||(t.Mode={})),t.DEFAULT_CONFIG={mode:n.POLLING,pollingServiceUrl:"https://poller.core.flagbase.com",pollingIntervalMs:3e5}},921:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(166),i=n(577),o=n(686),s=r(n(823)),u=()=>{try{const e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}},l=(e,t,n)=>{u()&&window.localStorage.setItem(`${e}_${t}`,JSON.stringify(n))},c=(e,t,n)=>{if(u()){const n=window.localStorage.getItem(`${e}_${t}`);if(null!==n)return JSON.parse(n)}return n};t.default=function(e,t,n){let r=Object.assign(Object.assign({},a.DEFAULT_CONFIG),t),u=Object.assign(Object.assign({},i.DEFAULT_IDENTITY),n),f={},d=Object.assign({},o.DEFAULT_INTERNAL_DATA);const _={clientKey:e,clientConfig:t,userIdentity:n},E=s.default(_),T=c(E,"flagset",{}),g=c(E,"internalData",o.DEFAULT_INTERNAL_DATA);return r=Object.assign({},r),u=Object.assign({},u),f=Object.assign(Object.assign({},f),T),d=Object.assign(Object.assign({},d),g),{getConfig:()=>Object.assign({},r),setConfig:e=>{r=Object.assign(Object.assign({},r),e)},getIdentity:()=>Object.assign({},u),setIdentity:e=>{u=Object.assign(Object.assign({},u),e)},getIdentityTraits:()=>Object.assign({},u.traits),setIdentityTraits:e=>{u=Object.assign(Object.assign({},u),{traits:Object.assign(Object.assign({},u.traits),e)})},getAllFlags:()=>Object.assign({},f),getFlag:e=>Object.assign({},f[e]),setFlag:(e,t)=>{f[e]=t,l(E,"flagset",f)},getInternalData:()=>Object.assign({},d),setInternalData:e=>{d=Object.assign(Object.assign({},d),e),l(E,"internalData",d)}}}},796:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.REASONS=void 0,(n=t.REASONS||(t.REASONS={})).FALLTHROUGH="FALLTHROUGH",n.FALLTHROUGH_WEIGHTED="FALLTHROUGH_WEIGHTED",n.TARGETED="TARGETED",n.TARGETED_WEIGHTED="TARGETED_WEIGHTED",n.DEFAULT_FALLTHROUGH="DEFAULT_FALLTHROUGH"},577:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_IDENTITY=void 0,t.DEFAULT_IDENTITY={identifier:"",traits:{}}},555:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_INTERNAL_DATA=t.DEFAULT_IDENTITY=t.REASONS=t.DEFAULT_CONFIG=t.Mode=void 0;const a=r(n(921)),i=n(166);Object.defineProperty(t,"Mode",{enumerable:!0,get:function(){return i.Mode}}),Object.defineProperty(t,"DEFAULT_CONFIG",{enumerable:!0,get:function(){return i.DEFAULT_CONFIG}});const o=n(796);Object.defineProperty(t,"REASONS",{enumerable:!0,get:function(){return o.REASONS}});const s=n(577);Object.defineProperty(t,"DEFAULT_IDENTITY",{enumerable:!0,get:function(){return s.DEFAULT_IDENTITY}});const u=n(686);Object.defineProperty(t,"DEFAULT_INTERNAL_DATA",{enumerable:!0,get:function(){return u.DEFAULT_INTERNAL_DATA}}),t.default=a.default},686:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_INTERNAL_DATA=void 0,t.DEFAULT_INTERNAL_DATA={consecutiveCachedRequests:0,consecutiveFailedRequests:0,flagsetChanges:0}},986:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EventType=void 0,(n=t.EventType||(t.EventType={})).CLIENT_READY="client_ready",n.FLAG_CHANGE="flag_change",n.CONTEXT_CHANGE="context_change",n.NETWORK_FETCH="network_fetch",n.NETWORK_FETCH_FULL="network_fetch_full",n.NETWORK_FETCH_CACHED="network_fetch_cached",n.NETWORK_FETCH_ERROR="network_fetch_error",n.DEBUG="debug"},244:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let e={};return{emit:(t,n,r)=>{e.hasOwnProperty(t)&&Object.values(e[t]).forEach((e=>e(n,r)))},on:(t,n)=>{e.hasOwnProperty(t)||(e[t]={}),"function"==typeof n&&(e[t]=Object.assign(Object.assign({},e[t]),{[n.toString()]:n}))},off:(t,n)=>{("function"!=typeof n||e.hasOwnProperty(t)||e[t].hasOwnProperty(n.toString()))&&("function"==typeof n&&e.hasOwnProperty(t)&&e[t].hasOwnProperty(n.toString())?delete e[t][n.toString()]:"function"!=typeof n&&e.hasOwnProperty(t)&&delete e[t])},clear:()=>{e={}}}}},554:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventType=void 0;const a=r(n(244)),i=n(986);Object.defineProperty(t,"EventType",{enumerable:!0,get:function(){return i.EventType}}),t.default=a.default},390:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SDK_KEY_HEADER=t.ETAG_HEADER=void 0,t.ETAG_HEADER="ETag",t.SDK_KEY_HEADER="x-sdk-key"},525:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFlagsViaPoller=void 0;const r=n(390),a=(e,t,n)=>new Promise(((a,i)=>{var o=new XMLHttpRequest;o.open("POST",e,!0),Object.keys(n).forEach((e=>o.setRequestHeader(e,n[e]))),o.onload=function(){4==this.readyState&&a({etag:this.getResponseHeader(r.ETAG_HEADER)||"unknown",status:this.status,hasFailed:!(200==this.status||304==this.status),data:200==this.status?JSON.parse(this.responseText).data:{}})},o.onerror=()=>a({etag:"unknown",status:o.status,hasFailed:!0,data:{}}),o.send(t)}));t.fetchFlagsViaPoller=async(e,t,n,i,o,s,u)=>{const{etag:l,status:c,data:f,hasFailed:d}=await a(String(e),JSON.stringify(n),{[r.ETAG_HEADER]:i,[r.SDK_KEY_HEADER]:t});return d||200!==c?d||304!==c?d&&"function"==typeof u&&u():"function"==typeof s&&s():"function"==typeof o&&o(l,f),[l,Array.isArray(f)?f:[]]}},354:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFlagsViaPoller=void 0;const r=n(525);Object.defineProperty(t,"fetchFlagsViaPoller",{enumerable:!0,get:function(){return r.fetchFlagsViaPoller}})},237:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EventType=t.Events=t.DEFAULT_INTERNAL_DATA=t.DEFAULT_IDENTITY=t.REASONS=t.DEFAULT_CONFIG=t.Mode=t.Context=void 0;const s=o(n(899)),u=i(n(555));t.Context=u.default,Object.defineProperty(t,"Mode",{enumerable:!0,get:function(){return u.Mode}}),Object.defineProperty(t,"DEFAULT_CONFIG",{enumerable:!0,get:function(){return u.DEFAULT_CONFIG}}),Object.defineProperty(t,"REASONS",{enumerable:!0,get:function(){return u.REASONS}}),Object.defineProperty(t,"DEFAULT_IDENTITY",{enumerable:!0,get:function(){return u.DEFAULT_IDENTITY}}),Object.defineProperty(t,"DEFAULT_INTERNAL_DATA",{enumerable:!0,get:function(){return u.DEFAULT_INTERNAL_DATA}});const l=i(n(554));t.Events=l.default,Object.defineProperty(t,"EventType",{enumerable:!0,get:function(){return l.EventType}}),t.default=s.default},488:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(35));t.default=a.default},117:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(354),a=n(986),i="initial";t.default=function(e,t,n){const o=t.getConfig(),s=o.pollingServiceUrl;let u=i;const l=(e,r)=>{if(null==r?void 0:r.length){r.forEach((e=>t.setFlag(e.attributes.flagKey,e.attributes)));const{flagsetChanges:e}=t.getInternalData();t.setInternalData({flagsetChanges:e+1}),n.emit(a.EventType.FLAG_CHANGE,"Flagset has changed")}u===i&&e!==u&&(n.emit(a.EventType.CLIENT_READY,"Client is ready!"),t.setInternalData({consecutiveCachedRequests:0,consecutiveFailedRequests:0})),u=e,n.emit(a.EventType.NETWORK_FETCH,"Retrieved flagset from service.",t.getAllFlags()),n.emit(a.EventType.NETWORK_FETCH_FULL,"Retrieved full flagset from service.",t.getInternalData())},c=()=>{const{consecutiveCachedRequests:e}=t.getInternalData();t.setInternalData({consecutiveCachedRequests:e+1,consecutiveFailedRequests:0}),n.emit(a.EventType.NETWORK_FETCH,"Retrieved flagset from service.",t.getAllFlags()),n.emit(a.EventType.NETWORK_FETCH_CACHED,"Retrieved cached flagset from service.",t.getInternalData())},f=()=>{const{consecutiveFailedRequests:e}=t.getInternalData();t.setInternalData({consecutiveCachedRequests:0,consecutiveFailedRequests:e+1}),n.emit(a.EventType.NETWORK_FETCH_ERROR,"Unable to retrieved flagset from service.",t.getInternalData())};let d=()=>{},_=()=>{};{const n=o.pollingIntervalMs&&o.pollingIntervalMs>=3e3&&o.pollingIntervalMs||3e3;let a=-1,i=setTimeout((()=>{}),1);const E=async()=>{i=setTimeout((async()=>{await T()}),n)},T=async()=>{const i=Date.now()-a;if(-1===a||i>=n&&!document.hidden){const[n]=await r.fetchFlagsViaPoller(s,e,t.getIdentity(),u,l,c,f);u=n,a=Date.now()}await E()};d=async()=>{clearTimeout(i),await T()},_=async()=>{clearTimeout(i)}}return{start:d,stop:_}}},343:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=n(986);t.default=function(e,t,n){const a="Streamer not implemented yet.";return{start:()=>n.emit(r.EventType.DEBUG,a),stop:()=>n.emit(r.EventType.DEBUG,a)}}},35:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(555),i=r(n(343)),o=r(n(117));t.default=function(e,t,n){return t.getConfig().mode===a.Mode.STREAMING?i.default(e,t,n):o.default(e,t,n)}},823:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n&=n;return n.toString(16)}}},t={},n=function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(237);return n.default})()));
//# sourceMappingURL=index.js.map